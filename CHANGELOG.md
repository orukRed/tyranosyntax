# Change Log

All notable changes to the "tyranosyntax" extension will be documented in this file.

Check [Keep a Changelog](http://keepachangelog.com/) for recommendations on how to structure this file.

## [0.19.6]- 2023-10-15

- プロジェクト読み込み失敗したときに、エラー通知を出すようにしました。  
本拡張機能はティラノスクリプト内のindex.htmlがあるフォルダを、vscodeのフォルダーを開く機能で開くこと前提のつくりとなっているためです。  
通知が出るのは以下の場合です。  
  - index.htmlがあるフォルダをvscodeで開き、初期設定完了したとき
  - index.htmlがあるフォルダをvscodeで開き、初期設定失敗した際
  - 初期設定完了後、index.htmlがあるフォルダを開いていないとき

## [0.19.5]- 2023-10-15

- .js拡張子内の、`tyrano.plugin.kag.tag.{タグ名}`で定義されたタグを利用した場合、プロジェクト内にプラグインが存在するにもかかわらず未定義扱いになる問題を修正しました。
- ver0.19.2で修正した、json読み込み失敗時の処理が不要になったので修正しました。
- ログを追加しました。

## [0.19.4]- 2023-10-15

- 内部の処理を微修正しました。この変更による動作の変更はありません。
  - ログ出力処理を追加しました。

## [0.19.3]- 2023-10-13

- ver0.19.3で発生したマウスホバーによるツールチップが表示されない不具合を修正しました。

## [0.19.2]- 2023-10-13

- 内部の処理を微修正しました。この変更による動作の変更はありません。

## [0.19.1]- 2023-10-10

- 内部の処理を微修正しました。
  - パーサー処理を外部から呼び出すのでなく、内部で処理するようにしました。
  - 動作の変更は意図していませんが、何かしらのバグが起きる可能性があります。

## [0.19.0]- 2023-10-09

- タグ補完で画像ファイルの候補を出した時、プレビュー表示されるようにしました。
- 内部の処理を微修正しました。

## [0.18.0]- 2023-10-03

- ツールチップで画像を表示できるようにしました。
  - タグのパラメータに画像のパスを指定すると、マウスホバーで画像が表示されます。
  - 自作タグやマクロについて同様の機能を使用する場合、設定から`TyranoScript syntax.tag.parameter`を修正してください。
  - 上記についてreadmeに追記しました。
- リファクタリングを行いました。
  - 構文解析処理を一部変更しました。

## [0.17.10]- 2023-09-23

- リファクタリングを行いました。
  - for inを使用している箇所があったのでfor ofに修正しました。

## [0.17.9]- 2023-08-08

- タグのパラメータに`%`を使った場合、エラー扱いになる問題を修正しました。
  - 本来はマクロ内で使用した場合のみ許容される処理ですが、暫定的にマクロ外でもOKとしています。

## [0.17.8]- 2023-08-06

- 特定の環境で拡張機能が動作しない問題調査のためコード修正を行いました。

## [0.17.7]- 2023-08-04

[issue#109](https://github.com/orukRed/tyranosyntax/issues/109)

- コメント中のタグにも診断機能が実施される問題を修正しました。
- プラグインで定義したタグがエラー扱いになる問題を修正しました。

## [0.17.6]- 2023-07-08

- 内部の処理を一部修正しました。

## [0.17.5]- 2023-07-03

- 以下のバグを修正しました。
  - 消したタグやマクロが補完機能に残っているバグを修正しました。
  - 消した変数が補完機能に残っているバグを修正しました。
  - 消したnameパラメータ等で定義した値が補完機能に残っているバグを修正しました。

## [0.17.4]- 2023-07-01

- 内部の処理を一部修正しました。

## [0.17.3]- 2023-06-28

- ライブラリを更新しました。

## [0.17.2]- 2023-06-27

- 動作に影響はありませんが、内部処理を一部変更しました。
  - 不要なログ出力処理を削除しました。

## [0.17.1]- 2023-06-24

- タグ補完時、パラメータに変数を使うとその行で常に変数の補完が表示されてしまう不具合を修正しました。

## [0.17.0]- 2023-06-19

- READMEを見やすくしました。
- .jsや.ksファイルで定義したタグの補完（パラメータを除く）、マクロの入力補完を実装しました。
  - jsで定義したタグのパラメータの補完に関しては今後の実装予定となります。
- chara_newタグなどの、nameで定義した値の入力補完を実装しました。
  - 現在補完されるパラメータの値は以下です。
  - name
  - id
  - face
  - part
- \#を入力した時、jnameで定義した値の入力補完を実装しました。
- `;region`と`;endregion`で囲った行を折りたためるようにしました。
- 変数の入力補完時に`f.`などの接頭辞が入力されない不具合を修正しました。

## [0.16.1]- 2023-05-22

- ファイルパスの入力補完を行おうとしたとき、「/」が入力された状態だと正しく補完が行われない不具合を修正しました。

## [0.16.0]- 2023-04-27

- ラベルへのインテリセンスを追加しました。各.ksで定義した「*」から始まるラベル一覧が表示されます。
  - targetパラメータでのみ使用できます。
  - storageタグでシナリオが指定されている場合、そのファイルに存在するラベルがインテリセンスに表示されます。
  - storageタグでシナリオが指定されていない場合、現在開いているファイルに存在するラベルがインテリセンスに表示されます。
  - storageタグで指定したシナリオが存在しない場合、インテリセンスは表示されません。
- 変数へのインテリセンスを追加しました。f. sf. tf. mp. から始まる値（頭に&ありも含む）が対象です。
  - .ksで一度でもevalタグで定義した値、もしくは.jsファイルで一度でも使用した値がインテリセンスに表示されます。
  - そのため、未定義の変数も表示されてしまいます。ご了承ください。

## [0.15.1]- 2023-04-12

[issue#74](https://github.com/orukRed/tyranosyntax/issues/74)

- .ksファイルを追加/削除した場合にインテリセンスが正しく表示できない場合がある不具合を修正しました。
- .ks,.jsファイルを削除してもmacroタグで定義したタグが診断機能上では存在してしまう不具合を修正しました。
- htmlタグとendhtmlタグで囲った箇所にもハイライトするようにしました。
  - 現在ハイライトに関してはjsと同じものとなっています。divタグなどもハイライトされてたのでこちらで実装していますが、不具合ありましたら報告お願いします。

## [0.15.0]- 2023-1-07

[issue#70](https://github.com/orukRed/tyranosyntax/issues/70)
[issue#79](https://github.com/orukRed/tyranosyntax/issues/79)
[issue#81](https://github.com/orukRed/tyranosyntax/issues/81)

- リソースへのインテリセンスを追加しました。
  - 今までと同様にパラメータのダブルクォーテーション(`"`)で囲まれている中で`ctrl + space`を押すと、リソースへのインテリセンスが使用できます。
    - 例：`@button graphic=""`の`@button graphic="`と`"`の間にカーソルがある状態で`ctrl + space`を押す
  - タグのパラメータごとに指定された拡張子のファイルのインテリセンスが表示されます。（buttonタグのgraphicパラメータなら".jpg",jpeg"".png",".gif","bmp",".svg"拡張子のファイルが表示されます。）
  - 設定の`TyranoScript syntax.resource.extension`から変更可能出来ます。
- 上記の追加に伴い、設定の`TyranoScript syntax.jump.tag`プロパティを廃止しました。今後alt + Jによるタグの指定ファイル先の設定を行う場合、`TyranoScript syntax.tag.parameter`を編集してください。
- 自動診断のデフォルト値をON（自動で診断をする）にしました。
- ハイライトに使用している正規表現を微リファクタリングしました。
- その他githubリポジトリの整理を行いました。

## [0.14.2]- 2022-11-15

[issue#62](https://github.com/orukRed/tyranosyntax/issues/62)

- インテリセンス（ctrl + space）でタグが正常に出力されない場合がある問題を修正しました。詳細は以下です。
  - bg2タグのパラメータを出力した場合、bgタグのパラメータが交じってしまっていました。
  - ptextタグのxパラメータが出力されませんでした。
  - []でタグを囲む書式で、一行に複数タグを配置した場合に最も左のタグのパラメータしか取得されませんでした。

## [0.14.1]- 2022-11-14

[issue#66](https://github.com/orukRed/tyranosyntax/issues/66)

- チップツールやインテリセンス、診断機能に用いるタグデータを最新のものにしました。

## [0.14.0]- 2022-11-13

[issue#58](https://github.com/orukRed/tyranosyntax/issues/58)

- [jump]などのタグで指定したstorageやtarget先へのジャンプ（ALT + J、もしくはoption + J）を実装しました。
  - 設定より、ジャンプ可能なタグは追加可能です
  - 自作マクロを追加する場合は、`storage`（もしくは`file`）パラメータにジャンプ先のファイル、`target`パラメータにラベル名を指定してください。
- 以下の不具合を修正しました。
  - @iscript,@endscriptの前に半角スペースやタブがあるとJS用のハイライトがされない問題

## [0.13.1]- 2022-10-23

[issue#59](https://github.com/orukRed/tyranosyntax/issues/59)

- 多くの環境で拡張機能が正常に動作しない問題を修正しました。

## [0.13.0]- 2022-10-22

[issue#54](https://github.com/orukRed/tyranosyntax/issues/54)

- マクロへの定義ジャンプを実装しました。(F12キー)
  - 上記変更に伴い、jsやksファイルで定義したタグ、マクロの読み込みタイミングをvscodeの起動してから最初に.ksファイルを開いた時（拡張機能の初期化時）に変更しました。
  - また、マクロ読み込みタイミング変更に伴いパフォーマンスが変更されました。
    - 診断機能の速度が向上しました。
    - 最初にTyranoScript syntax初期化したときに時間がかかるようになりました。（プロジェクトの大きさにもよりますが、0.5～5秒ほどかかります。）
    - TyranoScript syntaxの初期化完了時にvscodeの右下に通知を出すようにしました。

## [0.12.1]- 2022-08-18

- ESLint等による不要なjsへの診断を防ぐため、診断アルゴリズムを一部変更しました。
  - ただし、tyranosyntax以外の拡張機能がある場合や、プロジェクト内のファイル編集状況によってはESLintが起動してしまう可能性があります。
  - 確実にjsファイルへの診断を防ぐ場合、ignoreファイルなどを作成することを推奨します。

## [0.12.0]- 2022-08-06

- 自動診断をONにしたときの挙動を一部修正しました。これにより自動診断をONにしても差し支えないレベルにパフォーマンスが向上しています。
  - プロジェクトへの診断中の場合、診断を実行しないようにしています。
  - 診断で実施するテキストファイルの読み込み回数を少なくしました。
  - 診断を重複して実行しないようにしました。
  - .ksファイルに記載されているifタグが閉じられていない場合に診断機能が正常に動作しなくなる不具合を修正しました。
- ログの微修正を行いました。
  - ログの出力箇所を追加しました。
  - ミリ秒単位まで時間を計測するようにしました。
  - ログ出力タイミングに一部誤りがあったため修正しました。
- changelog.mdの並び順を最新のアップデートが上に来るように修正しました。

## [0.11.0] - 2022-7-07

- 使用しているタグが、macroタグで定義されている/外部モジュール(data/others内の.jsファイル)に定義されているかの診断ができるようになりました。
  - macroタグ、もしくはjsファイルのどちらにも定義されていない場合問題ウィンドウにその旨が表示されます。
- 診断機能が原因でPCの動作が重くなるため、ON/OFFの切り替えオプションを追加しました。初期設定でOFFとなっています。
- 上記修正に伴い、コマンドパレットで「tyrao.diagnostic」を入力することで能動的に診断機能を実行できるようにしました。
  - 今後のアップデートでPCの動作速度が改善され次第、この機能は削除される可能性があります。
- ログにタイムスタンプが出力されるようになりました。

## [0.10.1] - 2022-6-11

- mp.から始まる変数（マクロ内変数）のハイライトがされていない不具合を修正しました。
- タグの属性にラベルを使ったとき、ハイフンがあると正しくハイライトされない不具合を修正しました。
- linuxなどの環境で拡張機能が動作しない不具合を修正しました。

## [0.10.0] - 2022-6-5

- [s] などといった、タグ名の後に半角スペースがない場合にチップツールが効かなくなっている不具合を修正しました。
- 特定の状況下で出力ウィンドウにTyranoScript syntaxという名前のログが出力されるようになりました。
  - 使用いただく分には特に変わり有りませんが、バグ報告いただいた際にログなどもいただければ非常に嬉しいです。
- index.htmlのあるフォルダを開いていなくても、vscodeでワークスペースとして開いたフォルダ内にindex.htmlがあれば診断機能が実施されるようになりました。

## [0.9.0] - 2022-5-29

- タグ予測候補を表示した際にパラメータが必須かどうか分かるようにしました。
- 診断機能を実装しました。問題ウィンドウに以下の項目が表示されます。
  - 存在しないシナリオファイル
  - 存在しないラベル
- 診断機能は今後も随時追加予定です。
- 診断機能実装に伴い、ツールチップの表示方法を変更しました。
  - 以前はタグの任意の箇所にマウスカーソルを置いてツールチップが表示されましたが、ver0.9.0よりタグ名にマウスカーソルをおいた場合のみツールチップが表示されます。
- ラベルでハイフン記号を使用したときハイライトされない不具合を再度修正しました。

## [0.8.0] - 2022-4-21

- 設定から、タグの予測変換時に@から始まるタグか[ ]で囲むタグかを選択できるようにしました。
- 拡張機能用のvscodeウィンドウで本拡張機能を読み込むとエラーが発生する不具合を修正しました。

## [0.7.1] - 2022-4-18

- ライブラリの依存関係を更新しました。

## [0.7.0] - 2022-4-18

- Web版vscodeにて一部機能を使用可能にしました。

## [0.6.0] - 2022-4-12

- 予測変換（β版）を実装しました。
- 予測変換の実装に伴い以前のスニペット機能を削除しました。
- #やラベルを使用する際、行頭に空白があってもハイライトされるようにしました。

## [0.5.4] - 2022-4-4

- パラメータの値に配列を使った時、添字に二桁以上の整数や変数を使うと正しくハイライトされない問題を修正しました。

## [0.5.3] - 2022-3-31

- 一つの行にタグを複数個配置した時正しくハイライトされない問題を修正しました。

## [0.5.2] - 2022-3-29

- 全角記号未対応のものがあったため対応しました。

## [0.5.1] - 2022-3-28

- 一部の日本語（、と。）が非対応になっている問題を修正しました。
- 中括弧があるとハイライトされないされない問題を修正しました。
- 末尾がf.mp3のファイルが有ると正しくハイライトされない問題を修正しました。
  - ただし、ファイル名がhoge-f.mp3やf.mp3等の場合は以前と同様に正しくハイライトされません。

## [0.5.0] - 2022-3-28

- ハイライトの問題を修正しました。
  - パラメータの値に半角スペースがあると正しくハイライトされない問題を修正しました。
  - パラメータの値で配列添字を使用した時正しくハイライトされない問題を修正しました。
  - exp、condパラメータで正しくハイライトされない問題を修正しました。
  - エンティティで使う&記号もハイライトするようにしました。
- パラメータの値はダブルクォーテーションで囲わないとハイライトされないようにしました。
- パラメータの値にラベルを指定した時ハイライトされるようにしました。
- 上記内容の適用に伴い、ver0.3.1で対応していた、同じ行に[]で囲んでタグがある時に一部の文字がハイライトされない不具合が再び発生しています。

## [0.4.1] - 2022-3-23

- 行頭にタブ、半角スペース、全角スペースがある場合@から始まるタグがハイライトされない問題を修正しました。
- ラベルで日本語がハイライトされない問題を修正しました。
- 変数に日本語を使用した時、伸ばし棒（ー）がハイライトされない問題を修正しました。
- 変数の先頭に半角カナを使用した場合、ハイライトされない問題を修正しました。
- スニペットからbgタグを生成した時にパラメータに説明文が混じっている問題を修正しました。

## [0.4.0] - 2022-3-22

- アウトライン表示するタグを任意のものに変更できるようにしました。
  - 設定->TyranoScript syntax->setting.jsonより変更してください。デフォルトでアウトライン表示されるタグは以下です。
    - ラベル（*から始まる行）
    - ifタグ
    - elseifタグ
    - elseタグ
    - endif
    - ignore
    - endignore
    - jumpタグ
    - callタグ
    - buttonタグ
    - glinkタグ
    - linkタグ
    - iscriptタグ
    - endscriptタグ
    - loadjsタグ
    - htmlタグ
    - endhtmlタグ
- コメントアウトしている行をアウトライン表示しないようにしました。
  - ただし、/**/によるアウトラインはβ版のため正しく表示・非表示されない場合があります。不要の場合は設定を変更して機能を無効にしてください。
- 変数をアウトライン表示するようにしました。

## [0.3.1] - 2022-3-14

- 同じ行に[]で囲んでタグがある時に一部の文字がハイライトされない不具合を修正しました。

## [0.3.0] - 2022-3-14

- マーケットプレイスの検索で見つかりやすくしました。
- ハイライトを全体的に見直しました。
  - 各種ラベルのハイライトに使われる色を変更しました。
  - 変数が正しくハイライトされていなかったため、正常にハイライトするようにしました。
    - ティラノスクリプトでサポートしている変数名のルールに沿ってハイライトされます。(f.sf.tf.のいずれかから始まり半角英数と全角文字、アンダーバーを使用可能。ただし変数名の最初に数字はNG)
    - タグ内で変数を使用した際にもハイライトされます。
    - ただしiscriptタグ内での変数ハイライトはver0.3現在未対応です。
  - []内、もしくは行頭に@マークが有る場合のみハイライトするようにしました。
  - 数値のハイライトを削除しました。
  - true,false,nullのハイライトを削除しました。
- マウスホバーで表示されるチップツール、スニペットを最新のものに対応しました。

## [0.2.1] - 2022-2-28

- ラベルにハイフン（-）やアンダースコア（_）を使用した際に正しくハイライトされない問題を修正しました。

## [0.2.0] - 2021-12-21

- 以下のショートカットキーで入力する文字列を任意のものへと変更できるようにしました。setting.jsonより変更できます。
  - [l][r] shift + enter
  - [p] ctrl + enter
  - \#  alt + enter

## [0.1.6] - 2021-10-07

- 最新のタグ（Ver510h）のシンタックスハイライトに対応しました。

## [0.1.5]

- 0.1.4で一部修正できていませんでしたので修正しました。

## [0.1.4]

- Macの場合に、ショートカットコマンドが正常に正しく機能しない不具合の修正
  - [l][r] shift + enter
  - [p] ctrl + enter（Macならcmd+enter）

## [0.1.3]

- 特定のタグの書き方でツールチップが正しく表示できない不具合を修正

## [0.1.2]

- .ksファイル以外でもshift + enter等のショートカットキーでタグを入力できる不具合を修正

## [0.1.1]

- 特定のタグ・記号の簡易出力（ショートカットキー）の追加
  - [l][r] shift + enter
  - [p] ctrl + enter
  - \#  alt + enter

## [0.1.0]

- タグにマウスカーソルを重ねたときに簡易リファレンスを表示

- シンタックスの表示形式を変更

- ツールチップの実装
  - ティラノスクリプトv5提供のタグにマウスカーソルを乗せると簡易的なタグの説明が表示されます。

- アウトライン機能の実装
  - ラベル（*から始まる行）
  - ifタグ
  - elseifタグ
  - elseタグ
  - endif
  - ignore
  - endignore
  - jumpタグ
  - callタグ
  - buttonタグ
  - glinkタグ
  - linkタグ
  - sタグ
  - iscriptタグ
  - endscriptタグ
  - loadjsタグ

## [0.0.5]

バグ修正

- タグの属性値に=が含まれる場合に正しくハイライトされないのを修正

## [0.0.4]

バグ修正
コメントアウトのショートカットキーを入力時、";"ではなくて"//"が追加される問題

## [0.0.3]

- javascriptのハイライトを追加（iscript～endscriptの間でのみ適用）

## [0.0.2]

バグ修正

- [bg]タグを追加したときに、2つ修正される問題の修正

- 一部のタグが正しくハイライトされない問題の修正

- \#が先頭にある行をハイライトするように設定

## [0.0.1]

シンタックスハイライト追加  
スニペット追加
